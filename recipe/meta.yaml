{% set name = "sqlite-zstd" %}
{% set version = "0.3.2.41" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  git_url: https://github.com/phiresky/sqlite-zstd.git

build:
  number: 2
  skip: true  # [not unix]

outputs:
  - name: sqlite-zstd
    script: build_lib.sh
    requirements:
      build:
        - {{ compiler("c") }}
        - {{ compiler('rust') }}
        - {{ stdlib('c') }}
        - cargo-bundle-licenses
      run:
        - sqlite
        - __osx >={{ MACOSX_DEPLOYMENT_TARGET|default("10.9") }}  # [osx and x86_64]

      test:
        commands:
          - echo '.quit' | sqlite3 -cmd ".load libsqlite_zstd${SHLIB_EXT}" 2>&1 | grep sqlite_zstd::create_extension

  - name: sqlite-zstd-python
    script: build_py.sh
    requirements:
      build:
        - {{ compiler('rust') }}
        - {{ stdlib('c') }}
        - python >=3.9
      host:
        - setuptools >=61.2
        - setuptools-scm >=6.2
        - setuptools-rust
        - pip
        - sqlite
      run:
        - python >=3.9
        - sqlite

    test:
      imports:
        - sqlite_zstd
      commands:
        - pip check
      requires:
        - pip



about:
  home: https://github.com/phiresky/sqlite-zstd
  summary: 'Transparent dictionary-based row-level compression for SQLite'
  description: |
    Extension for sqlite that provides transparent dictionary-based row-level
    compression for sqlite. This basically allows you to compress entries in a
    sqlite database almost as well as if you were compressing the whole DB
    file, but while retaining random access.
  license: LGPL-3.0-only
  license_family: LGPL
  license_file:
    - THIRDPARTY.yml
    - LICENSE

extra:
  recipe-maintainers:
    - matthiasdiener
